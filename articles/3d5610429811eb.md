---
title: "ãƒ­ãƒ¼ã‚«ãƒ«ã§Drizzle Studioã®D1 Driverã‚’ä½¿ç”¨ã™ã‚‹éš›ã®æ³¨æ„ç‚¹"
emoji: "ğŸ¤¶"
type: "tech"
topics: [cloudflare, d1, drizzle, drizzle-kit, drizzle-studio]
published: false
---


ç¾çŠ¶`drizzle-kit`ã®ãƒªãƒã‚¸ãƒˆãƒªè‡ªä½“ã¯[ã¾ã å…¬é–‹ã•ã‚Œã¦ãŠã‚‰ãš](https://github.com/drizzle-team/drizzle-orm/discussions/795#discussioncomment-6251093)ã€â†“issueã®å¯¾å¿œã¯ã¾ã å…ˆã«ãªã‚Šãã†ãªã®ã§ã€ã¨ã‚Šã‚ãˆãšã®ä¸€æ¬¡å¯¾å¿œã¨ã—ã¦ãƒ¡ãƒ¢ã‚’æ®‹ã—ã¾ã™ã€‚
https://github.com/drizzle-team/drizzle-kit-mirror/issues/242

-----
Cloudflare D1ã‚’ä½¿ç”¨ã™ã‚‹éš›ã«ã€æœ€è¿‘ã§ã¯`Drizzle ORM`ã¨ã„ã†ã‚¯ã‚¨ãƒªãƒ“ãƒ«ãƒ€ãƒ¼ã‚’æ¡ç”¨ã™ã‚‹æ–¹ãŒå¤šã„ã¨æ€ã„ã¾ã™ã€‚
Drizzle TeamãŒæä¾›ã™ã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªç¾¤ã®ä¸­ã«ã¯ã‚¯ã‚¨ãƒªãƒ“ãƒ«ãƒ€ãƒ¼ã®æ©Ÿèƒ½ã‚’æä¾›ã™ã‚‹Drizzle ORMã®ä»–ã«ã€DDLã®ç”Ÿæˆã‚„ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãªã©ã®æ©Ÿèƒ½ã‚’æä¾›ã™ã‚‹`Drizzle Kit`ã¨ã„ã†ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒã‚ã‚Šã¾ã™ã€‚

ã“ã®`Drizzle Kit`ã‹ã‚‰`Drizzle Studio`ã¨ã„ã†ãƒ–ãƒ©ã‚¦ã‚¶ä¸Šã§SQLã‚¯ã‚¨ãƒªã®ç™ºè¡Œã‚„Viewã‚’ç¢ºèªã§ãã‚‹ä¾¿åˆ©ãªSQLã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®ãƒ„ãƒ¼ãƒ«ãŒæä¾›ã•ã‚Œã¦ã„ã¾ã™ã€‚

https://orm.drizzle.team/drizzle-studio/overview

ã“ã®`Drizzle Studio`ã‚’Cloudflare D1ã§ä½¿ç”¨ã™ã‚‹å ´åˆã€`drizzle.config`ã«`d1`ã¨ã„ã†ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã‚’æŒ‡å®šã—ã€`wrangler.toml`ã«è¨˜è¼‰ã•ã‚Œã¦ã„ã‚‹DBåã®æƒ…å ±ã‚’è¨˜è¿°ã—ã€`drizzle-kit studio`ã§ã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•ã™ã‚‹ã“ã¨ã§ã€ãƒªãƒ¢ãƒ¼ãƒˆã®D1ã«æ¥ç¶šã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚


```typescript:drizzle.config.ts
import type { Config } from 'drizzle-kit'

const cfConfig = {
  schema: './schema/db/schema.ts',
  out: './schema/db/migrations',
  driver: 'd1',
  dbCredentials: {
    wranglerConfigPath: './wrangler.toml',
    dbName: 'test-app',
  },
  verbose: false,
  strict: true,
} satisfies Config
```

```toml:wrangler.toml
name = "api"
compatibility_date = "2023-10-16"
send_metrics = false
node_compat = true
main = "cmd/server/index.ts"


[[d1_databases]]
binding = "DB"
database_name = "test-db"
database_id = "xxx"
migrations_dir = "./schema/db/migrations"
```

ã—ã‹ã—ã€ã“ã®è¨­å®šæ–¹æ³•ã§ã¯`Drizzle Studio`ã‹ã‚‰ã¯ãƒ­ãƒ¼ã‚«ãƒ«ã®D1ã«æ¥ç¶šã§ãã¾ã›ã‚“ã€‚
(`wrangler dev`ã®ã‚ˆã†ã«Cloudflareç”¨ã®Runtimeã‚’ä½¿ç”¨ã—ã€å†…éƒ¨çš„ã«ãƒ­ãƒ¼ã‚«ãƒ«ã®sqliteã‚’ä½¿ç”¨ã™ã‚‹ã‚ˆã†ã«åˆ‡ã‚Šæ›¿ãˆã¦ãã‚Œã¦ã„ãªã„ãŸã‚)

ç¾çŠ¶Drizzleã®Configã®å‹å®šç¾©ã‚’è¦‹ã‚‹é™ã‚Šã€`driver: "d1"`ã®å ´åˆã¯ãƒ­ãƒ¼ã‚«ãƒ«ã®D1ã«æ¥ç¶šã™ã‚‹æ–¹æ³•ã¯ç”¨æ„ã•ã‚Œã¦ã„ãªã„ã‚ˆã†ã«è¦‹ãˆã¾ã™ã€‚
```ts
export type Config = {
    out?: string | undefined;
    breakpoints?: boolean | undefined;
    tablesFilter?: string | string[] | undefined;
    schemaFilter?: string | string[] | undefined;
    schema?: string | string[];
    verbose?: boolean | undefined;
    strict?: boolean | undefined;
} (
    // ...
    {
    driver: "d1";
    dbCredentials: {
        wranglerConfigPath: string;
        dbName: string;
    };
} | {});
```

ãªã®ã§ã€ãƒ­ãƒ¼ã‚«ãƒ«ã§D1ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã¯ã€`drizzle.config`ã®`driver`ã‚’`better-sqlite`ã«å¤‰æ›´ã—ã€`dbCredentials`ã‚’`wrangler`ã®ã‚³ãƒãƒ³ãƒ‰ã«ã‚ˆã£ã¦ç”Ÿæˆã•ã‚ŒãŸsqliteã®ãƒã‚¤ãƒŠãƒªã‚’æŒ‡å®šã—ã¦ã‚ã’ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

https://github.com/sugar-cat7/d1-drizzle-studio/blob/main/service/api/drizzle.config.ts

ã“ã‚Œã§ã¨ã‚Šã‚ãˆãšã¯ãƒ­ãƒ¼ã‚«ãƒ«ã®D1ã«å¯¾ã—ã¦`Drizzle Studio`ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
![image](/images/d1-drizzle/drizzle.png)


ä»–ã«è‰¯ã„æ–¹æ³•ã‚ã£ãŸã‚‰æ•™ãˆã¦ãã ã•ã„ã€‚
