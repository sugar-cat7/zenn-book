---
title: ""
emoji: "üòΩ"
type: "tech" # tech: ÊäÄË°ìË®ò‰∫ã / idea: „Ç¢„Ç§„Éá„Ç¢
topics: [Container Apps + API Management„ÅßÊßãÁØâ„Åô„ÇãAPI Gateway]
published: false
---




„Åì„Çì„Å´„Å°„ÅØ„ÄÅÈñãÁô∫„ÉÅ„Éº„É†„ÅÆÁü≥‰∫ï„Åß„Åô„ÄÇÊú¨Ë®ò‰∫ã„ÅØAI Shift Advent Calendar 2023„ÅÆ?Êó•ÁõÆ„ÅÆË®ò‰∫ã„Å´„Å™„Çä„Åæ„Åô„ÄÇ

„Åø„Å™„Åï„Çì„ÅÆÁí∞Â¢É„Åß„ÇÇ„Ç¢„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥Èñì/„Çµ„Éº„Éì„ÇπÈñì„Åß„ÅÆÈÄö‰ø°„Å®„Åó„Å¶REST„ÇÑgRPC„ÇíÂà©Áî®„Åï„Çå„Å¶„ÅÑ„Çã„Åì„Å®„Å®ÊÄù„ÅÑ„Åæ„Åô„ÄÇ
‰æøÂà©„Åß„ÅØ„ÅÇ„Çä„Åæ„Åô„Åå„ÄÅ„ÉÜ„Çπ„Éà„ÇÑ‰ªñ„ÉÅ„Éº„É†„Åã„Çâ„ÅÆË¶ÅË´ã„Åß‰∏ÄÈÉ®API„ÇíSecure„Å´ÂÖ¨Èñã„Åó„Åü„ÅÑÔºÅ„Å®ÊÄù„Çè„Çå„Åü„Åì„Å®„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì„ÅãÔºü

‰ªäÂõû„ÅÆË®ò‰∫ã„Åß„ÅØ„ÄÅContainer Apps + API Management„ÅßAPI Gateway„ÇíÊßãÁØâ„Åô„ÇãÊâãÈ†Ü„Çí„ÅîÁ¥π‰ªã„Åó„Åæ„Åô„ÄÇ

ÊßãÊàê



‚Äª‰ªäÂõû„ÅØÊ§úË®ºÁî®Áí∞Â¢É„ÅÆÊ∫ñÂÇô„ÅÆ„Åü„ÇÅDeveloper Plan„ÇíÂà©Áî®„Åó„Åæ„Åô„ÄÇ
Êú¨Áï™Áí∞Â¢É„Åß„ÅÆÂà©Áî®„ÅØÊ•≠ÂãôË¶Å‰ª∂Á≠â„ÇíËÄÉÊÖÆ„Åó„Å¶„ÅîÊ§úË®é„Åè„Å†„Åï„ÅÑ„ÄÇ

### API Management„Å®„ÅØ

Web API„ÇíÁµ±ÂêàÁÆ°ÁêÜ„Åô„Çã„Åü„ÇÅ„ÅÆ„Éó„É©„ÉÉ„Éà„Éï„Ç©„Éº„É†„Åß„Åô„ÄÇ
Azure‰∏ä„ÅÆ„É™„ÇΩ„Éº„Çπ‰∏ä„Å´ÊßãÁØâ„Åï„Çå„ÅüAPI„ÇÑ„ÄÅ„Ç™„É≥„Éó„É¨„Éü„Çπ„ÅÆAPI„ÇíÁµ±ÂêàÁÆ°ÁêÜ„Åô„Çã„Åì„Å®„Åå„Åß„Åç„ÄÅË™çË®º„ÉªË™çÂèØ„ÄÅ„Çπ„É≠„ÉÉ„Éà„É™„É≥„Ç∞„Å™„Å©„ÇíÂà∂Âæ°„Åô„Çã„Åì„Å®„Åå„Åß„Åç„Åæ„Åô„ÄÇ

![Alt text](api-management.png)

‰ªäÂõû„ÅÆ„Éá„É¢„Åß„ÅØContainer Apps‰∏ä„Å´ÊßãÁØâ„Åó„ÅüREST API„ÇíÂà©Áî®„Åó„Åæ„Åô„Åå„ÄÅgRPCÁ≠â„Åß„ÇÇÂà©Áî®ÂèØËÉΩ„Åß„Åô„ÄÇ

### Containers Apps„Å®„ÅØ

Kubernetes ‰∏ä„Å´ÊßãÁØâ„Åï„Çå„Åü„Éû„Éç„Éº„Ç∏„Éâ„Çµ„Éº„Éì„Çπ„Åß„ÄÅAKS„Å®Áï∞„Å™„Çä„ÇØ„É©„Çπ„Çø„ÉºÊßãÊàê„ÇÑÁÆ°ÁêÜ„ÅÆÊâãÈñì„Åå‰∏çË¶Å„Åß„Çπ„Éî„Éº„Éá„Ç£„Éº„Ç¢„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥„ÅÆÊßãÁØâ„ÅåÂèØËÉΩ„Å™„Ç¢„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥ÈñãÁô∫„Å´ÁÑ¶ÁÇπ„ÅåÂΩì„Å¶„Çâ„Çå„Åü„Çµ„Éº„Éì„Çπ„Åß„Åô„ÄÇ

2022„Å´GA„Åï„Çå„ÅüÂæåÁô∫„Å™„Çµ„Éº„Éì„Çπ„Å†„Åë„ÅÇ„Å£„Å¶ÈùûÂ∏∏„Å´È´òÊ©üËÉΩ„Åã„Å§‰Ωø„ÅÑ„ÇÑ„Åô„ÅÑ„Çµ„Éº„Éì„Çπ„Å®„Å™„Å£„Å¶„ÅÑ„Åæ„Åô„ÄÇ

- CNCF OSS„ÅåÁµÑ„ÅøËæº„Åø: Envoy„ÄÅKEDA„ÄÅDapr
- „É¶„Éº„Ç∂Ë™çË®ºÊ©üËÉΩ
- „Ç´„Éä„É™„Ç¢„É™„É™„Éº„Çπ/AB„ÉÜ„Çπ„Éà/BlueGreen„Éá„Éó„É≠„Ç§„É°„É≥„Éà
- k8s„ÇØ„É©„Çπ„Çø„ÅÆÁÆ°ÁêÜ‰∏çË¶Å
- Service Connector„Å´„Çà„Çã‰ªñAzure„É™„ÇΩ„Éº„Çπ„Å®„ÅÆÈÄ£Êê∫„ÅÆÂÆπÊòì„Åï

https://learn.microsoft.com/ja-jp/azure/container-apps/overview


## „Éá„É¢Áí∞Â¢É„ÅÆÊßãÁØâ






### Resource Group„ÅÆ‰ΩúÊàê

ÈÅ©ÂΩì„Å™„É™„ÇΩ„Éº„Çπ„Ç∞„É´„Éº„Éó„Çí‰Ωú„Çä„Åù„ÅÆ‰∏≠„Å´Vnet„Çí‰Ωú„Å£„Å¶„ÅÑ„Åç„Åæ„Åô„ÄÇ
ContainerApps„ÄÅAPI Management„ÄÅPrivate DNSÁî®„Å´„Åù„Çå„Åû„Çå„Çµ„Éñ„Éç„ÉÉ„Éà„Çí‰Ωú„Å£„Å¶„ÅÑ„Åç„Åæ„Åô„ÄÇ


### Container Apps„ÅÆ‰ΩúÊàê

Container Apps„Å´„ÅØContainer„É™„ÇΩ„Éº„Çπ„ÇíÁÆ°ÁêÜ„Åô„ÇãContainer Apps Environment„Çí‰ΩúÊàê„Åô„ÇãÂøÖË¶Å„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ
„Åì„ÅÆEnvironment„Å´ÂØæ„Åó„Å¶„Çµ„Éñ„Éç„ÉÉ„Éà„ÇíÂâ≤„ÇäÂΩì„Å¶„Çã„Åì„Å®„ÅßContainer Apps„ÅåÂà©Áî®„Åô„Çã„Éç„ÉÉ„Éà„ÉØ„Éº„ÇØ„ÇíÂà∂Âæ°„Åô„Çã„Åì„Å®„Åå„Åß„Åç„Åæ„Åô„ÄÇ
‚ÄªÊúÄ‰Ωé„Åß„ÇÇ/27„ÅÆ„Çµ„Éñ„Éç„ÉÉ„Éà„ÇíÂâ≤„ÇäÂΩì„Å¶„ÇãÂøÖË¶Å„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ

![Alt text](container-app-env2.png)

„Ç§„É°„Éº„Ç∏„ÅØ„Çµ„É≥„Éó„É´„ÅÆ„ÇÇ„ÅÆ„ÇíÂà©Áî®„Åó„ÄÅContainer Apps„Çí‰ΩúÊàê„Åó„Åæ„Åô„ÄÇ
Internal„Å´Ë®≠ÂÆö„Åô„Çã„Åì„Å®„Åß„ÄÅVnetÂÜÖ„Åã„Çâ„ÅÆ„Åø„Ç¢„ÇØ„Çª„ÇπÂèØËÉΩ„Å™Áí∞Â¢É„Å®„Å™„Å£„Å¶„ÅÑ„Åæ„Åô„ÄÇ
![Alt text](container-app3.png)

„Éá„Éó„É≠„Ç§„Åï„Çå„Åü„ÇâApplication Url„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åø„Åæ„Åô„ÄÇ
ÊàêÂäü„Åó„Å¶„ÅÑ„Çå„Å∞„Ç¢„ÇØ„Çª„Çπ„Åå„Åß„Åç„Å™„ÅÑ„ÅØ„Åö„Åß„Åô„ÄÇ

![Alt text](container-setting.png)

![Alt text](noaccess.png)

Ê¨°„Å´„Éó„É©„Ç§„Éô„Éº„ÉàDNS„Çæ„Éº„É≥„Çí‰ΩúÊàê„Åó„Åæ„Åô„ÄÇ
VnetÂÜÖ„ÅßAPI Management„Å®Container Apps„ÅÆÂêçÂâçËß£Ê±∫„ÇíË°å„ÅÜ„Åü„ÇÅ„Å´ÂøÖË¶Å„Å®„Å™„Çä„Åæ„Åô

‰ΩúÊàê„Åô„Çã„Éó„É©„Ç§„Éô„Éº„ÉàDNS„Çæ„Éº„É≥„ÅÆ„ÄåÂêçÂâç„Äç„Å´„ÅØ„ÄÅ„Ç≥„É≥„ÉÜ„Éä„Éº„Ç¢„Éó„É™„ÅÆ„Äå„Ç¢„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥URL„Äç„ÅÆ„Éâ„É°„Ç§„É≥ÈÉ®ÂàÜ„ÇíÊåáÂÆö„Åó„Åæ„Åô„ÄÇ

![Alt text](private-dns-instance-detail.png)

„É™„ÇΩ„Éº„Çπ„ÅåÂá∫Êù•‰∏ä„Åå„Å£„Åü„Çâ„É¨„Ç≥„Éº„Éâ„Çí‰ΩúÊàê„Åó„Åæ„Åô„ÄÇ
![Alt text](record.png)

![Alt text](network-link.png)

### API Management„ÅÆ‰ΩúÊàê

‰ªäÂõûAPI Management„Å´„ÅØPublicIP„ÇíÂâ≤„ÇäÂΩì„Å¶API Gateway„Å®„Åó„Å¶Âà©Áî®„Åó„Åæ„Åô„ÄÇ
„Åù„ÅÆÈöõ„Å´„Ç§„É≥„Çø„Éº„Éç„ÉÉ„Éà„Åã„Çâ„ÅÆ„Ç¢„ÇØ„Çª„ÇπÁ≠â„ÇíÂà∂Âæ°„Åô„Çã„Åü„ÇÅ„Å´NSG„ÇíÂâ≤„ÇäÂΩì„Å¶„Åü„Çµ„Éñ„Éç„ÉÉ„Éà„Å´Á¥ê„Å•„Åë„Åæ„Åô„ÄÇ

![NSG](subnet-api-management.png)
![Alt text](subnet-api-management2.png)
https://learn.microsoft.com/ja-jp/azure/api-management/api-management-using-with-vnet?tabs=stv2#configure-nsg-rules

„Åæ„ÅüIP„Ç¢„Éâ„É¨„Çπ„ÇÇÂèñÂæó„Åó„Åæ„Åô„ÄÇ(SKU„ÅÆStandard„ÅßÂèñÂæó„Åó„Å™„ÅÑ„Å®API Manageent„Å´„ÅØÂâ≤„ÇäÂΩì„Å¶„Çâ„Çå„Åæ„Åõ„Çì„ÄÇ)
ÂèñÂæó„Åó„Åü„Çâconfigulation„Åã„ÇâDNSÂêç„ÅÆ„É©„Éô„É´‰ªò„Åë„ÇíË°å„ÅÑ„Åæ„Åô„ÄÇ
![Alt text](ip-dns-name.png)

„Åì„Åì„Åæ„ÅßÊ∫ñÂÇô„Åß„Åç„Åü„ÇâAPI Management„Çí‰ΩúÊàê„Åó„Åæ„Åô„ÄÇ

„Åù„ÅÆÈöõ„Å´ÂÖà„Åª„Å©‰ΩúÊàê„Åó„Åü„Çµ„Éñ„Éç„ÉÉ„Éà„Åä„Çà„Å≥IP„Ç¢„Éâ„É¨„Çπ„ÇíÊåáÂÆö„Åó„Åæ„Åô„ÄÇ

![Alt text](api-management2.png)

„É™„ÇΩ„Éº„Çπ„Çí‰ΩúÊàê„Åó„Åü„Çâ„ÄÅAPI Management„ÅÆË®≠ÂÆö„ÇíË°å„ÅÑ„Åæ„Åô„ÄÇ

container apps„Çíimport„Åó„Åæ„Åô„ÄÇ
![Alt text](api-management-container.png)

import„Åó„ÅüÈöõ„Å´Ë®≠ÂÆö„Åó„Åüsuffix„Å®gateway„ÅÆURL„ÇíÂêà„Çè„Åõ„Å¶„Ç¢„ÇØ„Çª„Çπ„Åô„Çã„Å®„Ç≥„É≥„ÉÜ„Éä„Éº„Ç¢„Éó„É™„Å´„Ç¢„ÇØ„Çª„Çπ„Åô„Çã„Åì„Å®„Åå„Åß„Åç„Åæ„Åô„ÄÇ
Ôºà„Éá„Éï„Ç©„É´„Éà„Åß„Çµ„Éñ„Çπ„ÇØ„É™„Éó„Ç∑„Éß„É≥„ÅåË¶ÅÊ±Ç„Åï„Çå„Çã„ÅÆ„Åß‰∏ÄÊôÇÁöÑ„Å´Ëß£Èô§„Åó„Å¶„ÅÑ„Åæ„ÅôÔºâ
![Alt text](image.png)

![Alt text](image-1.png)

„Åì„Åì„Åæ„Åß„ÅßAPI ManagementÁµåÁî±Container Apps„Å´„Ç¢„ÇØ„Çª„Çπ„Åô„Çã„Åì„Å®„Åå„Åß„Åç„Åæ„Åó„Åü„ÄÇ

IPÂà∂Èôê„ÇÑÊµÅÈáèÁÆ°ÁêÜ„ÅØAPI Management„ÅÆÊ©üËÉΩ„ÇíÂà©Áî®„Åô„Çã„Åì„Å®„ÅßÂà∂Âæ°„Åô„Çã„Åì„Å®„Åå„Åß„Åç„Åæ„Åô„ÄÇ

‰æã„Åà„Å∞API ManagementÁµåÁî±„ÅÆÂÖ®„Å¶„ÅÆ„É™„ÇØ„Ç®„Çπ„Éà„Å´ IPÂà∂Èôê„Çí„Åã„Åë„Åü„ÅÑÂ†¥Âêà„ÅØ‰∏ãË®ò„ÅÆ„Çà„ÅÜ„Å´filter„ÇíË®≠ÂÆö„Åó„Åæ„Åô„ÄÇ


![Alt text](all-ip.png)

Ë®≠ÂÆö‰ª•Â§ñ„ÅÆ IP„Åã„Çâ„ÅÇ„Åè„Åõ„Åô„Åó„ÅüÂ†¥Âêà„ÅØ„Ç¢„ÇØ„Çª„Çπ„ÅåÊãíÂê¶„Åï„Çå„Çã„Çà„ÅÜ„Å´„Å™„Çä„Åæ„Åó„Åü„ÄÇ
![Alt text](no.png)

„Åì„Åì„Åæ„Åß„ÅßÂÜíÈ†≠Á¥π‰ªã„Åó„Åü„Åì„Çå„ÅÆÂÆüÁèæ„Åå„Åß„Åç„Åæ„Åó„Åü„ÄÇ




## „Åä„Åæ„Åë

‰ªäÂõû„ÅØÁ∞°ÊòìÁöÑ„Å™ÂÆüÈ®ì„ÅÆ„Åü„ÇÅ„Å´ Sample Image„ÇíÂà©Áî®„Åó„Åæ„Åó„Åü„Åå„Çà„ÇäÂÆüÈÅãÁî®„Å´Ëøë„ÅÑ„Çà„ÅÜ„Å™ÊßãÊàê„ÇÇÁ¥π‰ªã„Åó„Åæ„Åô„ÄÇ


### „Éá„É¢Áî®„ÅÆ„Ç§„É°„Éº„Ç∏„ÇíÁî®ÊÑè„Åô„Çã

‰ªäÂõû„ÅØ Bun+Typescript„ÅßÊßãÊàê„Åï„Çå„ÅüÁ∞°ÊòìÁöÑ„Å™REST API„ÇíÁî®ÊÑè„Åó„Åæ„Åô„ÄÇ

[repo-url]

‰ªäÂõû„ÅØAzure Registory„Å´„Ç§„É°„Éº„Ç∏„ÇíPush„Åó„Å¶„ÄÅ„Åù„Åì„Åã„Çâ Container Apps„Å´„Éá„Éó„É≠„Ç§„Åó„Åæ„Åô„ÄÇ

linux/amd64„ÅÆ„Ç§„É°„Éº„Ç∏„ÇíÁî®ÊÑè„Åó„Åæ„Åô„ÄÇ(Container Apps„ÅØArm64„ÅÆ„Ç§„É°„Éº„Ç∏„Å´„ÅØÂØæÂøú„Åó„Å¶„ÅÑ„Åæ„Åõ„Çì)

```bash
$ docker build --pull --platform linux/amd64 -t bun-hello-world .
$ docker tag bun-hello-world devnozomi.azurecr.io/dev
$ docker push devnozomi.azurecr.io/dev
```

registry„ÅØPremiumÂá∫„Å™„ÅÑ„Å®PrivateÁí∞Â¢É„Åß„ÅÆ‰ΩøÁî®„Åå„Åß„Åç„Å™„ÅÑ„ÅÆ„Åß„ÄÅ‰ªäÂõû„ÅØÁ∞°Âçò„ÅÆ„Åü„ÇÅ„Å´Public„Å´„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ

„ÅÇ„Å®„ÅØÂÖà„Åª„Å©„ÅÆÊâãÈ†Ü„ÅßSaple Image„ÇíÂà©Áî®„Åô„Çã„Å®„Åì„Çç„ÇíÂ§âÊõ¥„Åó„Å¶RegistryÁµåÁî±„ÅßImage„ÇíÊíÆ„Å£„Å¶„Åç„Å¶„Ç≥„É≥„ÉÜ„ÉäÂåñ„Çí„Åó„Åæ„Åô„ÄÇ


### Postgres„Çµ„Éº„Éê„Éº„ÅÆÁî®ÊÑè

Azure Database for PostgreSQL„ÇíÁî®ÊÑè„Åó„Åæ„Åô„ÄÇ

Developer Plan„ÇíÂà©Áî®„Åô„ÇãÂ†¥Âêà„ÅØ„ÄÅAzure Database for PostgreSQL„ÅÆ„Éï„É¨„Ç≠„Ç∑„Éñ„É´„Çµ„Éº„Éê„Éº„Çí‰ΩúÊàê„Åô„ÇãÂøÖË¶Å„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ

https://learn.microsoft.com/ja-jp/azure/postgresql/flexible-server/overview


„Çµ„Éñ„Éç„ÉÉ„Éà„ÇíÊ∫ñÂÇô„Åó„Åæ„Åô„ÄÇ
„Çµ„Éñ„Éç„ÉÉ„Éà„ÇíÂßî‰ªª„Åô„ÇãÂøÖË¶Å„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇÔºàMicrosoft.DBforPostgreSQL/flexibleServersÔºâ
![Alt text](subnet-pg.png)

https://learn.microsoft.com/ja-jp/azure/postgresql/flexible-server/concepts-networking-private#virtual-network-concepts


Postgres„Çµ„Éº„Éê„Éº„ÇÇVnet‰ª•Â§ñ„Åã„Çâ„ÅÆ„Ç¢„ÇØ„Çª„Çπ„ÇíÈò≤„Åé„Åü„ÅÑ„ÅÆ„Åß„ÄÅPrivate access (VNet Integration)„ÇíÈÅ∏Êäû„Åó„Åæ„Åô„ÄÇ

![Alt text](network-pg.png)

„Åì„Å°„Çâ„ÇÇcontainer AppsÂêåÊßò„Å´Private DNS„Çæ„Éº„É≥„Çí‰ΩúÊàê„Åó„Åæ„Åô„ÄÇ
Flexible Server„ÅÆ‰ΩúÊàêÊôÇ„Å´ÂêåÊôÇ„Å´Ëá™Âãï‰ΩúÊàê„Åô„Çã„Åì„Å®„ÇÇÂèØËÉΩ„Åß„Åô„ÄÇ

![Alt text](pg-dns.png)

### Container Apps„Å®Azure Database for PostgreSQL„ÇíÁπã„Åê


„Åì„ÅÆPostgres„Çµ„Éº„Éê„Éº„Å®Container Apps„ÇíÈÄ£Êê∫„Åï„Åõ„Çã„Åü„ÇÅ„Å´„ÄÅService Connector„ÇíÂà©Áî®„Åó„Åæ„Åô„ÄÇ

Service Connector„ÅØAzure‰∏ä„ÅÆ„É™„ÇΩ„Éº„Çπ„Å®„ÅÆÈÄ£Êê∫„ÇíÂÆπÊòì„Å´„Åô„Çã„Åü„ÇÅ„ÅÆÊ©üËÉΩ„Åß„Åô„ÄÇ
„Åì„Çå„ÇíÂà©Áî®„Åô„Çã„Å®Áí∞Â¢ÉÂ§âÊï∞„ÅÆÊÉÖÂ†±„Å™„Å©„ÇíËá™Âãï„ÅßContainer Apps„Å´Ë®≠ÂÆö„Åô„Çã„Åì„Å®„Åå„Åß„Åç„Åæ„Åô„ÄÇ

‰∏äË®ò„Åß‰ΩúÊàê„Åó„Åüpostgres„Çµ„Éº„Éê„Éº„ÇíÈÅ∏Êäû„Åó„ÄÅContainer Apps„Å®ÈÄ£Êê∫„Åï„Åõ„Åæ„Åô„ÄÇ

Container AppsÂÅ¥„Åß‰ΩøÁî®„Åô„Çã„É©„É≥„Çø„Ç§„É†„ÅÆÁí∞Â¢É„Å´„ÅÇ„Çè„Åõ„Å¶Êé•Á∂öÊÉÖÂ†±„ÇíË®≠ÂÆö„Åó„Åæ„Åô„ÄÇ

![Alt text](service-connector.png)


„Åì„Åì„Åæ„ÅßË°å„ÅÜ„Å®Container„Åã„ÇâPostgres„Çµ„Éº„Éê„Éº„Å´„Ç¢„ÇØ„Çª„Çπ„Åô„Çã„Åì„Å®„Åå„Åß„Åç„Åæ„Åô„ÄÇ

ÂÆüÈöõ„Å´„Ç≥„É≥„ÉÜ„Éä„Åã„Çâ„Ç¢„ÇØ„Çª„Çπ„Åó„Å¶„Åø„Åæ„Åô„ÄÇ
Monitoring„ÅÆConsole„Åã„Çâ„Ç≥„É≥„ÉÜ„Éä„ÇíÁ¢∫Ë™ç„Åß„Åç„Åæ„Åô„ÄÇ
postgres„ÅÆ„Çµ„Éº„Éê„ÉºÂêç„ÇíÊåáÂÆö„Åó„Å¶`nslookup`„Åó„Å¶„Åø„Åæ„Åô„ÄÇ


![Alt text](nslookup.png)

Ê≠£Â∏∏„Å´Ëß£Ê±∫„Åß„Åç„Å¶„ÅÑ„Åù„ÅÜ„Åß„Åô„ÄÇ

Ê¨°„Å´ÊâãÂÖÉ„Åã„ÇâÁõ¥„Å´Postgres„Çµ„Éº„Éê„Éº„Å´„Ç¢„ÇØ„Çª„Çπ„Åó„Å¶„Åø„Åæ„Åô„ÄÇ
„Åì„Çå„ÅØÂÖ¨Èñã„Åó„Å¶„ÅÑ„Å™„ÅÑ„ÅÆ„Åß„Ç¢„ÇØ„Çª„Çπ„Åß„Åç„Å™„ÅÑ„ÅØ„Åö„Åß„Åô„ÄÇ
![Alt text](host-psql.png)
„Åß„Åç„Åæ„Åõ„Çì„Åß„Åó„Åü„ÄÇÊ≠£„Åó„ÅèVnetÂÜÖ„Åß„ÅÆ„Åø„Ç¢„ÇØ„Çª„Çπ„ÅåÂà∂Âæ°„Åß„Åç„Å¶„ÅÑ„Åù„ÅÜ„Åß„Åô„ÄÇ


Ê¨°„ÅØAPI Management„Åã„ÇâContainer Apps„Å´„Ç¢„ÇØ„Çª„Çπ„Åó„ÄÅContainer Apps„Å´ÊßãÁØâ„Åó„Åü„Ç¢„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥„Åã„ÇâPostgres„Çµ„Éº„Éê„Éº„Å´„Ç¢„ÇØ„Çª„Çπ„Åß„Åç„Çã„ÅãÁ¢∫Ë™ç„Åó„Åæ„Åô„ÄÇ

„ÇΩ„Éº„Çπ„ÅØ„Åì„Å°„Çâ„Åß„Åô„ÄÇ
DB„Å´„É≠„Ç∞„Ç§„É≥„Åó„Å¶„ÅÑ„Çã„É¶„Éº„Ç∂„Éº„ÅÆÊÉÖÂ†±„ÇíÂèñÂæó„Åô„ÇãAPI„Åß„Åô„ÄÇ

TLS„ÅÆË®≠ÂÆö„ÇíË°å„ÅÜ„Åü„ÇÅ„Å´„ÄÅPostgres„Çµ„Éº„Éê„Éº„ÅÆË®ºÊòéÊõ∏„Çí„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ
„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ„ÅØPortal„Åã„ÇâË°å„ÅÜ„Åì„Å®„Åå„Åß„Åç„Åæ„Åô„ÄÇ
‚ÄªÊ≥®ÊÑè: ‰ªäÂõû„ÅØ‰∏ÄÊôÇÁöÑ„Å™„Éá„É¢„Ç¢„Éó„É™„ÅÆ„Åü„ÇÅ„Ç§„É°„Éº„Ç∏„Å´Ë®ºÊòéÊõ∏„ÇíÂê´„ÇÅ„Å¶„ÅÑ„Åæ„Åô„Åå„ÄÅÊú¨Áï™Áí∞Â¢É„Åß„ÅØAzure Key Vault„Å™„Å©„Å´Ë®ºÊòéÊõ∏„Çí‰øùÂ≠ò„Åó„Å¶Âà©Áî®„Åô„Çã„Åì„Å®„Çí„Åä„Åô„Åô„ÇÅ„Åó„Åæ„Åô„ÄÇ
```typescript
import { Hono } from "hono";
import { Pool } from "pg";
import fs from "fs";
const app = new Hono();

const sslConfig = Bun.env.AZURE_POSTGRESQL_SSL
  ? {
      ca: fs.readFileSync("./DigiCertGlobalRootCA.crt.pem"),
    }
  : false;

const pool = new Pool({
  user: Bun.env.AZURE_POSTGRESQL_USER,
  host: Bun.env.AZURE_POSTGRESQL_HOST,
  database: Bun.env.AZURE_POSTGRESQL_DATABASE,
  password: Bun.env.AZURE_POSTGRESQL_PASSWORD,
  port: parseInt(Bun.env.AZURE_POSTGRESQL_PORT!, 10),
  ssl: sslConfig,
});

app.get("/", async (c) => {
  try {
    console.log("Connecting to database");
    const client = await pool.connect();
    try {
      const result = await client.query("SELECT current_user;");
      const currentUser = result.rows.at(0).current_user;
      return c.json({ message: `Hello, ${currentUser}` }, 200);
    } finally {
      client.release();
    }
  } catch (err) {
    if (err instanceof Error) {
      console.error(err);
      return c.json({ error: err.message }, 500);
    }
    console.error("An unknown error occurred");
    return c.json({ error: "An unknown error occurred" }, 500);
  }
});

export default app;
```

```Dockerfile
# use the official Bun image
FROM oven/bun:1 as base
WORKDIR /usr/src/app

# Install common network troubleshooting tools
RUN apt-get update && apt-get install -y \
    curl \
    telnet \
    netcat \
    dnsutils

# install dependencies into temp directory
# this will cache them and speed up future builds
FROM base AS install
RUN mkdir -p /temp/dev
COPY package.json bun.lockb /temp/dev/
RUN cd /temp/dev && bun install --frozen-lockfile

# install with --production (exclude devDependencies)
RUN mkdir -p /temp/prod
COPY package.json bun.lockb /temp/prod/
RUN cd /temp/prod && bun install --frozen-lockfile --production

# copy node_modules from temp directory
# then copy all (non-ignored) project files into the image
FROM base AS prerelease
COPY --from=install /temp/dev/node_modules node_modules
COPY . .

# Copy the DigiCertGlobalRootCA.crt.pem file
COPY DigiCertGlobalRootCA.crt.pem ./

# [optional] tests & build
ENV NODE_ENV=production
RUN bun test
RUN bun run build

# copy production dependencies and source code into final image
FROM base AS release
COPY --from=install /temp/prod/node_modules node_modules
COPY --from=prerelease /usr/src/app/index.ts .
COPY --from=prerelease /usr/src/app/package.json .

# Copy the DigiCertGlobalRootCA.crt.pem file to final image
COPY --from=prerelease /usr/src/app/DigiCertGlobalRootCA.crt.pem ./

# run the app
USER bun
EXPOSE 3000/tcp
ENTRYPOINT [ "bun", "run", "index.ts" ]

```

„Ç¢„ÇØ„Çª„Çπ„Åß„Åç„Åæ„Åó„Åü„ÄÇ
![Alt text](api-mabagement-pg.png)



„Åì„ÅÆ„Çà„ÅÜ„Å´„Åó„Å¶‰∏ãË®ò„ÅÆÊßãÊàê„ÇíÂÆüÁèæ„Åô„Çã„Åì„Å®„Åå„Åß„Åç„Åæ„Åó„Åü„ÄÇ

### „Åæ„Å®„ÇÅ
