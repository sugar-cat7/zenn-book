---
title: "Agoneså…¨ä½“æ¦‚è¦ç·¨"
emoji: "ğŸ®"
type: "idea" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [agones, kubernetes, gameserver]
published: true
---

ã“ã‚“ã«ã¡ã¯ã€[@sugar235711](https://twitter.com/sugar235711)ã§ã™ã€‚
ã“ã®è¨˜äº‹ã¯ã€Œã²ã¨ã‚Šã§æ°—ã«ãªã‚‹OSSã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰å…¨éƒ¨èª­ã‚“ã§ä½•ã‹ã™ã‚‹ Advent Calendar 2025ã€1æ—¥ç›®ã®è¨˜äº‹ã§ã™ã€‚
https://qiita.com/advent-calendar/2025/sugarcat

ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã®é€šã‚Šã€å€‹äººçš„ã«æ°—ã«ãªã£ã¦ã„ã‚‹ã“ã¨ã‚’èª¿ã¹ã¦æº€è¶³ã™ã‚‹ã ã‘ã®è‡ªå·±æº€è¶³è¨˜äº‹ã§ã™ã€‚
å¤§ä½“â†“ã®æµã‚Œã§é€²ã¿ã¾ã™ã€‚Kubernetesã‚„å„ç¨®ã‚¯ãƒ©ã‚¦ãƒ‰ç­‰ã®çŸ¥è­˜ã¯ã‚ã‚‹å‰æã§æ›¸ã„ã¦ã„ã¾ã™ã€‚åˆå›ä»¥å¤–ã¯åŸºæœ¬å†…éƒ¨å®Ÿè£…ã‚’è¿½ã£ã¦ã„ãã¾ã™ã€‚ç‰¹ã«äººã«è¦‹ã›ã‚‹ã“ã¨ã‚’ç›®çš„ã«ã—ã¦ã„ãªã„ãŸã‚ã‹ãªã‚Šé›‘ã§ã™ã€‚

- [å…¨ä½“ç·¨](https://zenn.dev/king/articles/4e55f030aa01ee) â†ã“ã“
- GameServerç·¨
- Fleetç·¨
- GameServerAllocationç·¨
- FleetAutoscalerç·¨
- Metricsç·¨

## å…¨ä½“æ¦‚è¦ç·¨
## Agonesã«é–¢ã—ã¦
Dedicated GameServerã‚’æ§‹æˆã™ã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆç¾¤ã‚’Kubernetesä¸Šã§æ‰±ãˆã‚‹ã‚ˆã†ã«ã—ãŸCustom Resourceç¾¤ã§ã™ã€‚

DGSå‚è€ƒ
- https://en.wikipedia.org/wiki/Game_server#Dedicated_server
- https://www.gdcvault.com/play/1015337/Dedicated-Servers-In-Gears-of
- https://developer.valvesoftware.com/wiki/Latency_Compensating_Methods_in_Client/Server_In-game_Protocol_Design_and_Optimization
- https://gafferongames.com/post/what_every_programmer_needs_to_know_about_game_networking/

Agonesã®èª•ç”Ÿ
ä¸‹è¨˜ã®é€šã‚Šã€ãƒãƒƒãƒãƒ¡ã‚¤ã‚­ãƒ³ã‚°ã®ä»•çµ„ã¿(Open Matchç­‰)ã¨çµ„ã¿åˆã‚ã›ã¦ä½¿ã†ã“ã¨ã‚’æƒ³å®šã•ã‚Œã¦ãŠã‚Šã€Dedicated Game Server Hostingã®ãŸã‚ã®ä»•çµ„ã¿ã¨ã—ã¦è¨­è¨ˆã•ã‚Œã¦ã„ã¾ã™ã€‚


![Agones Architecture](https://storage.googleapis.com/gweb-cloudblog-publish/original_images/image24unv.GIF)

>Players connect to some kind of matchmaker service, which groups them (often by skill level) to play a match. 
>Once players are matched for a game session, the matchmaker tells a game server manager to provide a dedicated game server process on a cluster of machines.
>The game server manager creates a new instance of a dedicated game server process that runs on one of the machines in the cluster. 
>The game server manager determines the IP address and the port that the dedicated game server process is running on, and passes that back to the matchmaker service.
>The matchmaker service passes the IP and port back to the playersâ€™ clients.
>The players connect directly to the dedicated game server process and play the multiplayer game against one another. 

https://cloud.google.com/blog/products/containers-kubernetes/introducing-agones-open-source-multiplayer-dedicated-game-server-hosting-built-on-kubernetes?hl=en

### å¤‰é·
2018å¹´ã«å…¬é–‹ã•ã‚ŒãŸv0.1ã§ã¯ã€UDPã§GameServerã®ã¿ã‚’æ‰±ãˆã‚‹ã‚·ãƒ³ãƒ—ãƒ«ãªCustom Resourceã¨ã—ã¦æä¾›ã•ã‚Œã¦ã„ã¾ã—ãŸã€‚
https://github.com/googleforgames/agones/blob/ffc160fbbec58f1b8021d814473d06f6d70e2041/pkg/gameservers/controller.go
ã“ã®ã¨ãã¯ãƒãƒ¼ãƒˆç®¡ç†/ã‚µã‚¤ãƒ‰ã‚«ãƒ¼æ³¨å…¥/Podã®ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ç®¡ç†ç­‰ã®åŸºæœ¬çš„ãªå®Ÿè£…ãŒã•ã‚Œã¦ãŠã‚Šã€SDKçµŒç”±ã§ã‚²ãƒ¼ãƒ ã‚µãƒ¼ãƒãƒ¼ã¸ã®æ¥ç¶šã‚’ç®¡ç†ã§ãã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã—ãŸã€‚
https://github.com/googleforgames/agones/blob/ffc160fbbec58f1b8021d814473d06f6d70e2041/sdks/cpp/README.md

ã“ã“ã‹ã‚‰v1.53.0ã¾ã§ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã•ã‚Œã€Fleeté–¢é€£ã®ãƒªã‚½ãƒ¼ã‚¹ã‚„å„ç¨®SDKç­‰ãŒæ•´å‚™ã•ã‚Œã¦ã„ã¾ã™ã€‚
https://github.com/googleforgames/agones/releases

### é–‹ç™º
Custom Controllerã«å¿…è¦ãªclientset/informer/workqueueç­‰ã®ç”Ÿæˆã«é–¢ã—ã¦ã¯code-generatorãŒä½¿ç”¨ã•ã‚Œã¦ã„ã¾ã™ã€‚
https://github.com/kubernetes/code-generator
https://github.com/googleforgames/agones/blob/main/build/build-image/gen-crd-code.sh

å„ç¨®Custom Resourceã¯pkgé…ä¸‹ã«é…ç½®ã•ã‚Œã¦ãŠã‚Šã€ãã‚Œãã‚Œã®Contollerå®Ÿè£…ãŒé…ç½®ã•ã‚Œã¦ã„ã¾ã™ã€‚
https://github.com/googleforgames/agones/tree/main/pkg

å„ä¸»è¦Public Cloudã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤é–¢é€£ã¯ãƒ†ã‚¹ãƒˆã•ã‚Œã¦ãŠã‚Šã€Helmã‚‚æä¾›ã•ã‚Œã¦ã„ã‚‹ãŸã‚å°å…¥è‡ªä½“ã¯ç°¡å˜ãã†ã§ã™ã€‚
https://github.com/googleforgames/agones/tree/main/install/helm/agones

### åˆ©ç”¨ç’°å¢ƒ
åŸºæœ¬ã¯ãƒ‘ãƒ–ãƒªãƒƒã‚¯ã‚¯ãƒ©ã‚¦ãƒ‰ä¸Šã®managed k8sä¸Šã§ä½¿ã†ã“ã¨ãŒæƒ³å®šã•ã‚Œã¦ã„ã¾ã™ã€‚
- Google Cloud
- AWS
- Azure
- OCI
ãŒå‹•ä½œç¢ºèªã•ã‚Œã¦ã„ãã†ã§ã™ã€‚
https://github.com/googleforgames/agones/blob/main/ci/e2e-test-cloudbuild.yaml

GKEã¯Autopilotã§ã‚‚ä½¿ãˆã¾ã™ã€‚
https://github.com/googleforgames/agones/blob/main/pkg/cloudproduct/gke/gke.go

Prometheusã¨ã®çµ±åˆã‚‚å¯èƒ½ã§ã€GameServerã‚„Fleetã®ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚’åé›†ã§ãã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚
https://agones.dev/site/docs/guides/metrics/

Grafanaãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ç­‰ã®ConfigMapã‚‚æä¾›ã•ã‚Œã¦ãŠã‚ŠAgonesã§ç›£è¦–ã™ã‚‹å¯¾è±¡ã‚’ç°¡å˜ã«å¯è¦–åŒ–ã§ãã¾ã™ã€‚
https://github.com/googleforgames/agones/tree/main/build/grafana

![Grafana Dashboard - GameServer](https://agones.dev/site/images/grafana-dashboard-controller.png)


### ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯
UDPã§ã®æ¥ç¶šãŒåŸºæœ¬ã¨ãªã‚‹ã®ã§ã€ãƒ¯ãƒ¼ã‚«ãƒ¼ãƒãƒ¼ãƒ‰ã«å¯¾ã—ã¦æ¥ç¶šã™ã‚‹ãŸã‚7000~8000ã®ãƒãƒ¼ãƒˆã‚’å¤–éƒ¨ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«ã§å¸¸æ™‚é–‹æ”¾ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
Kubernetesã®HostPortæ©Ÿèƒ½ã‚’åˆ©ç”¨ã—ã€å‹•çš„ã«ãƒãƒ¼ãƒ‰ã®IPã¨Portã®çµ„ã¿åˆã‚ã›ã‚’ä½¿ç”¨ã—ã¦ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‹ã‚‰ã®æ¥ç¶šã‚’å¯èƒ½ã«ã—ã¦ã„ã¾ã™ã€‚
https://agones.dev/site/docs/reference/gameserver/

### ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹
åŸºæœ¬çš„ã«OpenMatchã¨çµ„ã¿åˆã‚ã›ãŸãƒãƒ«ãƒãƒ—ãƒ¬ã‚¤ç³»ã®ã‚²ãƒ¼ãƒ ã§ã®åˆ©ç”¨ãŒå¤šã„ã§ã™ã€‚
https://github.com/googleforgames/open-match
ãŸã ãã‚Œä»¥å¤–ã«ã‚‚WebSocketã®ã‚µãƒ¼ãƒãƒ¼ã®ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°å…ˆã¨ã—ã¦ã®åˆ©ç”¨ã‚„éŸ³å£°ã€AIç³»ã®è©±é¡Œã‚‚ã‚ã‚Šã¾ã—ãŸã€‚
ä»¥ä¸‹ãƒªãƒ³ã‚¯ã ã‘è²¼ã£ã¦ãŠãã¾ã™ã€‚

ã‚²ãƒ¼ãƒ 
https://www.techedt.com/bandai-namco-launches-dragon-ball-gekishin-squadra-with-google-cloud#google_vignette
https://cedec.cesa.or.jp/2025/timetable/detail/s67a473fd79c0d/
https://speakerdeck.com/dena_tech/kubernetestoagonesniyoruriarutaimugemusabayun-yong-dena-techcon-2022
https://speakerdeck.com/toversus/da-gui-mo-kemuinhuratositefalse-kubernetes-tofalsementenansuyun-yong
https://speakerdeck.com/colopl/da-gui-mo-torahuitukuwozhi-eru-gemubatukuendonoke-ti-togou-cheng-nobian-qian-an-ding-sitagemuti-yan-woshi-xian-surutameni
https://speakerdeck.com/pobo380/riarutaimugemusabakai-fa-ji-shu-sutatukumatome
https://www.youtube.com/watch?v=HN5yDW-Vi8A

éŸ³å£°
https://speakerdeck.com/gree_tech/greetechcon2022-session-c-6
https://speakerdeck.com/mixi_engineers/voice-communication-function-using-quic-which-created-on-agones

AI
https://engineers.ntt.com/entry/2023/12/13/090235

### ã¾ã¨ã‚

æ˜æ—¥ã‹ã‚‰å†…éƒ¨ã®ã‚³ãƒ¼ãƒ‰ã‚’èª­ã¿é€²ã‚ã¦ã„ãã¾ã™ã€‚